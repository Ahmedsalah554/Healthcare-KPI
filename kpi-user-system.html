<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</title>
    
    <link rel="stylesheet" href="./css/variables.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/user-styles.css">
    <link rel="stylesheet" href="./css/charts.css">
    
    <style>
        /* Ø§Ø³ØªØ§ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-right: 5px solid;
            transition: all 0.3s;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .category-card.wfm { border-right-color: #1a73e8; }
        .category-card.utz { border-right-color: #4caf50; }
        .category-card.mp { border-right-color: #f44336; }
        .category-card.phc { border-right-color: #ff9800; }
        .category-card.ipc { border-right-color: #9c27b0; }
        .category-card.ps { border-right-color: #e91e63; }
        .category-card.ohs { border-right-color: #00bcd4; }
        .category-card.mm { border-right-color: #8bc34a; }
        .category-card.lab { border-right-color: #ff5722; }
        .category-card.df { border-right-color: #607d8b; }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-code {
            font-size: 0.9rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            background: rgba(26, 115, 232, 0.1);
            color: #1a73e8;
        }

        .category-card.wfm .category-code { background: rgba(26, 115, 232, 0.1); color: #1a73e8; }
        .category-card.utz .category-code { background: rgba(76, 175, 80, 0.1); color: #4caf50; }
        .category-card.mp .category-code { background: rgba(244, 67, 54, 0.1); color: #f44336; }
        .category-card.phc .category-code { background: rgba(255, 152, 0, 0.1); color: #ff9800; }
        .category-card.ipc .category-code { background: rgba(156, 39, 176, 0.1); color: #9c27b0; }
        .category-card.ps .category-code { background: rgba(233, 30, 99, 0.1); color: #e91e63; }
        .category-card.ohs .category-code { background: rgba(0, 188, 212, 0.1); color: #00bcd4; }
        .category-card.mm .category-code { background: rgba(139, 195, 74, 0.1); color: #8bc34a; }
        .category-card.lab .category-code { background: rgba(255, 87, 34, 0.1); color: #ff5722; }
        .category-card.df .category-code { background: rgba(96, 125, 139, 0.1); color: #607d8b; }

        .category-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .category-progress {
            font-size: 0.9rem;
            color: #666;
        }

        .kpis-list {
            margin-top: 20px;
            display: none;
        }

        .kpis-list.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 2000px;
            }
        }

        .kpi-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 3px solid #1a73e8;
            cursor: pointer;
            transition: all 0.3s;
        }

        .kpi-item:hover {
            background: #e3f2fd;
            transform: translateX(-5px);
        }

        .kpi-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kpi-item-code {
            font-weight: 700;
            color: #1a73e8;
            font-size: 0.9rem;
        }

        .kpi-item-name {
            font-size: 0.95rem;
            color: #333;
            margin-top: 5px;
        }

        .page-header {
            background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .page-header .breadcrumb {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: white;
            color: #1a73e8;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .back-button:hover {
            background: #f5f5f5;
            transform: translateX(5px);
        }

        .kpi-form-container {
            display: none;
        }

        .formula-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-right: 4px solid #1a73e8;
        }
    </style>
</head>
<body>
    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">ğŸ‘¤</div>
                <h1>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h1>
                <p>Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</p>
            </div>

            <div class="login-error" id="loginError" style="display: none;"></div>

            <form id="loginForm" class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="loginEmail" required placeholder="user@hospital.com" value="user@hospital.com">
                </div>

                <div class="form-group">
                    <label for="loginPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="loginPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="user123">
                </div>

                <div class="remember-forgot">
                    <label>
                        <input type="checkbox"> ØªØ°ÙƒØ±Ù†ÙŠ
                    </label>
                    <a href="#" onclick="alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„'); return false;">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>

            <div class="mt-2" style="text-align: center; color: #666; font-size: 0.9rem;">
                <p><strong>Ù„Ù„ØªØ¬Ø±Ø¨Ø©:</strong></p>
                <p>Ø§Ù„Ø¨Ø±ÙŠØ¯: user@hospital.com</p>
                <p>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: user123</p>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div id="appPage" class="app-page" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <h1>ğŸ“Š Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</h1>
            <div class="app-header-right">
                <div class="facility-badge" id="facilityNameDisplay">Ø§Ù„Ù…Ù†Ø´Ø£Ø©</div>
                <div class="user-badge" id="userNameDisplay">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
                <button class="btn-logout" onclick="handleLogout()">
                    ğŸšª Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </header>

        <!-- Content -->
        <div class="app-content">
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¤Ø´Ø± -->
            <div id="kpiFormContainer" class="kpi-form-container">
                <div class="kpi-form">
                    <button class="back-button" onclick="closeKPIForm()">
                        â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                    </button>

                    <div class="kpi-form-header">
                        <h2 class="kpi-form-title" id="kpiFormTitle">Ø§Ø®ØªØ± Ù…Ø¤Ø´Ø±Ø§Ù‹ Ù„Ù„Ø¨Ø¯Ø¡</h2>
                    </div>

                    <div id="formulaInfo"></div>

                    <form id="kpiDataForm" onsubmit="saveKPIData(event)">
                        <div class="input-row">
                            <div class="input-group">
                                <label for="kpiDate">Ø§Ù„ØªØ§Ø±ÙŠØ® *</label>
                                <input type="date" id="kpiDate" required>
                            </div>

                            <div class="input-group">
                                <label for="kpiPeriod">Ø§Ù„ÙØªØ±Ø© *</label>
                                <select id="kpiPeriod" required>
                                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© --</option>
                                    <option value="Ø´Ù‡Ø±ÙŠ">Ø´Ù‡Ø±ÙŠ</option>
                                    <option value="Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option>
                                    <option value="Ù†ØµÙ Ø³Ù†ÙˆÙŠ">Ù†ØµÙ Ø³Ù†ÙˆÙŠ</option>
                                    <option value="Ø³Ù†ÙˆÙŠ">Ø³Ù†ÙˆÙŠ</option>
                                </select>
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-group">
                                <label id="numeratorLabel" for="kpiNumerator">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø³Ø· *</label>
                                <input type="number" id="kpiNumerator" step="0.01" required placeholder="0" oninput="calculateResult()">
                            </div>

                            <div class="input-group">
                                <label id="denominatorLabel" for="kpiDenominator">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚Ø§Ù… *</label>
                                <input type="number" id="kpiDenominator" step="0.01" required placeholder="0" oninput="calculateResult()">
                            </div>
                        </div>

                        <div class="result-box" id="resultBox" style="display: none;">
                            <div class="result-label">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©</div>
                            <div class="result-value" id="resultValue">0.00%</div>
                        </div>

                        <div class="form-group">
                            <label for="kpiNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <textarea id="kpiNotes" rows="3" placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§..."></textarea>
                        </div>

                        <div class="action-buttons">
                            <button type="submit" class="btn btn-primary">
                                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            </button>
                            <button type="button" class="btn btn-reset" onclick="resetKPIForm()">
                                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ¦Ø§Øª ÙˆØ§Ù„Ù…Ø¤Ø´Ø±Ø§Øª -->
            <div id="categoriesView">
                <div class="page-header">
                    <h1>ğŸ“‹ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</h1>
                    <div class="breadcrumb">Ø§Ù„ÙˆØ­Ø¯Ø©: ÙˆØ­Ø¯Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ â€” Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰: <span id="facilityBreadcrumb">Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø¹ÙŠÙ†ÙŠ</span></div>
                </div>

                <div class="kpi-search" style="margin-bottom: 20px;">
                    <input type="text" id="kpiSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¤Ø´Ø±..." oninput="filterKPIsBySearch()">
                </div>

                <div id="categoriesContainer" class="categories-grid"></div>
            </div>

            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('categoriesTab')">
                        ğŸ“‹ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
                    </button>
                    <button class="tab-btn" onclick="switchTab('dataHistory')">
                        ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©
                    </button>
                    <button class="tab-btn" onclick="switchTab('export')">
                        ğŸ“¥ Ø§Ù„ØªØµØ¯ÙŠØ±
                    </button>
                </div>

                <!-- Tab 1: Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª -->
                <div id="categoriesTab" class="tab-content active">
                    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ¸Ù‡Ø± ÙÙŠ categoriesView -->
                </div>

                <!-- Tab 2: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© -->
                <div id="dataHistory" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</div>
                            <button class="btn btn-danger btn-small" onclick="clearHistory()">
                                ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                            </button>
                        </div>

                        <div class="empty-message" id="emptyMessage" style="display: none;">
                            <div class="empty-icon">ğŸ“­</div>
                            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                            <p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</p>
                        </div>

                        <div class="data-table-container">
                            <table class="data-table" id="dataTable">
                                <thead>
                                    <tr>
                                        <th>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¤Ø´Ø±</th>
                                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                        <th>Ø§Ù„ÙØªØ±Ø©</th>
                                        <th>Ø§Ù„Ø¨Ø³Ø·</th>
                                        <th>Ø§Ù„Ù…Ù‚Ø§Ù…</th>
                                        <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Ø§Ù„ØªØµØ¯ÙŠØ± -->
                <div id="export" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                        </div>

                        <div class="export-stats">
                            <div class="stat-box">
                                <div class="stat-box-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                                <div class="stat-box-value" id="statsCount">0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-box-label">Ø§Ù„Ù…Ù†Ø´Ø£Ø©</div>
                                <div class="stat-box-value" id="statsFacility" style="font-size: 1.2rem;">-</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-box-label">Ø¢Ø®Ø± Ø¥Ø¯Ø®Ø§Ù„</div>
                                <div class="stat-box-value" id="statsDate" style="font-size: 1rem;">-</div>
                            </div>
                        </div>

                        <div class="export-buttons">
                            <button class="btn btn-success" onclick="exportToCSV()">
                                ğŸ“„ ØªØµØ¯ÙŠØ± CSV
                            </button>
                            <button class="btn btn-primary" onclick="exportToJSON()">
                                ğŸ“‹ ØªØµØ¯ÙŠØ± JSON
                            </button>
                            <button class="btn btn-danger" onclick="printData()">
                                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                            </button>
                        </div>

                        <div class="alert alert-info mt-3" style="background: #e3f2fd; padding: 15px; border-radius: 8px; display: flex; gap: 10px;">
                            <span>ğŸ’¡</span>
                            <div>
                                <strong>Ù†ØµÙŠØ­Ø©:</strong> ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ù…Ø¹ ÙØ±ÙŠÙ‚Ùƒ.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>
    <script src="./js/utils.js"></script>
    <script src="./js/kpi-data.js"></script>
    <script src="./js/charts.js"></script>
    <script src="./js/user-main.js"></script>
</body>
</html>
